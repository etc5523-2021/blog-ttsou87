---
title: "COVID-19 in the United Kingdom(England)"
description: |
   This post contains simple overview of the COVID-19 statistics in United Kingdom and the vaccination statistics up till August, 2021.
author:
  - name: Tina Tsou
date: 09-14-2021
categories:
  - Covid-19
  - Vaccination
output:
  distill::distill_article:
    self_contained: false
    toc: true
bibliography: ../../references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      cache = TRUE)

```

```{r libraries}
# load library
library(tidyverse)
library(ggplot2)
library(gganimate)
library(readxl)
library(plotly)
library(kableExtra)
library(lubridate)
library(leaflet)
```

## Introduction
As we close to the end of second year living under the coronavirus pandemic, hopes of returning back to normal seems more and more like a dream because there seems to be no end in case numbers. Even with the roll-out of vaccines to fight against the virus, we can't seem to beat the speed at which the virus mutates into stronger variants. The United Kingdom is a country who has no shortage of COVID-19 vaccines.
The government has mobilized its resources and secured doses to vaccinate its people quickly. This blog aims to explore the status of the country during the pandemic as well as the impacts of vaccination.

## Data Description
Three data sets are used in this analysis.[Coronavirus (Covid-19) in the UK](https://coronavirus.data.gov.uk/) is the main source for these data sets.

### COVID-19 Confirmed cases and Death
```{r cases}
cases <- read.csv(here::here("data","cases-uk.csv"))%>%
  select(!c(areaType, areaName, areaCode))

death <- read.csv(here::here("data","deathsâ€“uk.csv"))%>%
  select(!c(areaType, areaName, areaCode))

ukdaily <- merge(cases,death, by= "date", all = TRUE)
ukdaily$date<- as.Date(ukdaily$date)
ukdaily[is.na(ukdaily)] <- 0

read_excel(here::here("data","ukdict.xlsx"), sheet=1) %>%
  kable(booktabs = TRUE)%>%
  kable_styling(fixed_thead = T) %>% 
  kable_paper("striped") %>%
  row_spec(0, bold = T, color = "#f3ac50", background = "#2596be", align = "c") %>%
  column_spec(2, italic = T)
```
#### Data Limitations

### Vaccination in the United Kingdom
```{r ukvaccinesuptake}
ukvacc <- read.csv(here::here("data","uk-vacc-uptake.csv"))%>%
  select(!c(areaType, areaName, areaCode))
ukvacc$date<- as.Date(ukvacc$date)

read_excel(here::here("data","ukdict.xlsx"), sheet=2) %>%
  kable(booktabs = TRUE)%>%
  kable_styling(fixed_thead = T) %>% 
  kable_paper("striped") %>%
  row_spec(0, bold = T, color = "#f3ac50", background = "#2596be", align = "c") %>%
  column_spec(2, italic = T)
```
#### Data Limitation

### Vaccination in England(Regions)

```{r df-vaccination-in-England}
#import region data
eastmidlands <- readr::read_csv("https://api.coronavirus.data.gov.uk/v2/data?areaType=region&areaCode=E12000004&metric=cumPeopleVaccinatedCompleteByPublishDate&metric=cumPeopleVaccinatedFirstDoseByPublishDate&metric=cumPeopleVaccinatedSecondDoseByPublishDate&format=csv")

eastofengland <- readr::read_csv("https://api.coronavirus.data.gov.uk/v2/data?areaType=region&areaCode=E12000006&metric=cumPeopleVaccinatedCompleteByPublishDate&metric=cumPeopleVaccinatedFirstDoseByPublishDate&metric=cumPeopleVaccinatedSecondDoseByPublishDate&format=csv")

london<- readr::read_csv("https://api.coronavirus.data.gov.uk/v2/data?areaType=region&areaCode=E12000007&metric=cumPeopleVaccinatedCompleteByPublishDate&metric=cumPeopleVaccinatedFirstDoseByPublishDate&metric=cumPeopleVaccinatedSecondDoseByPublishDate&format=csv")

northeast<- readr::read_csv("https://api.coronavirus.data.gov.uk/v2/data?areaType=region&areaCode=E12000001&metric=cumPeopleVaccinatedCompleteByPublishDate&metric=cumPeopleVaccinatedFirstDoseByPublishDate&metric=cumPeopleVaccinatedSecondDoseByPublishDate&format=csv")

northwest<- readr::read_csv("https://api.coronavirus.data.gov.uk/v2/data?areaType=region&areaCode=E12000002&metric=cumPeopleVaccinatedCompleteByPublishDate&metric=cumPeopleVaccinatedFirstDoseByPublishDate&metric=cumPeopleVaccinatedSecondDoseByPublishDate&format=csv")

southeast<- readr::read_csv("https://api.coronavirus.data.gov.uk/v2/data?areaType=region&areaCode=E12000008&metric=cumPeopleVaccinatedCompleteByPublishDate&metric=cumPeopleVaccinatedFirstDoseByPublishDate&metric=cumPeopleVaccinatedSecondDoseByPublishDate&format=csv")

southwest<- readr::read_csv("https://api.coronavirus.data.gov.uk/v2/data?areaType=region&areaCode=E12000009&metric=cumPeopleVaccinatedCompleteByPublishDate&metric=cumPeopleVaccinatedFirstDoseByPublishDate&metric=cumPeopleVaccinatedSecondDoseByPublishDate&format=csv")

westmidlands<- readr::read_csv("https://api.coronavirus.data.gov.uk/v2/data?areaType=region&areaCode=E12000005&metric=cumPeopleVaccinatedCompleteByPublishDate&metric=cumPeopleVaccinatedFirstDoseByPublishDate&metric=cumPeopleVaccinatedSecondDoseByPublishDate&format=csv")

yorkshirehumber<- readr::read_csv("https://api.coronavirus.data.gov.uk/v2/data?areaType=region&areaCode=E12000003&metric=cumPeopleVaccinatedCompleteByPublishDate&metric=cumPeopleVaccinatedFirstDoseByPublishDate&metric=cumPeopleVaccinatedSecondDoseByPublishDate&format=csv")


areaCode <- c('E12000001','E12000002','E12000003','E12000004','E12000005','E12000006','E12000007','E12000008','E12000009')
pop <- c(2680763, 7367456,5526350,4865583,5961929,6269161,9002488,9217265,5695143)
population <- as.data.frame(cbind(areaCode,pop))

vaccdf <- rbind(eastmidlands, eastofengland, london, northeast, northwest,southeast, southwest, westmidlands, yorkshirehumber) %>% 
  rename('Completely Vaccinated' = cumPeopleVaccinatedCompleteByPublishDate,
         "First Dose" = cumPeopleVaccinatedFirstDoseByPublishDate,
         "Second Dose" = cumPeopleVaccinatedSecondDoseByPublishDate)
vaccdf <- vaccdf[order(match(vaccdf$areaCode,population$areaCode)),]


vaccdf <- vaccdf %>% left_join(.,population, by = 'areaCode')
vaccdf <- vaccdf%>% 
  mutate(pop = as.numeric(pop),
         firstperc = round(`First Dose`/pop*100, digits = 2),
         secondperc = round(`Second Dose`/pop*100, digits = 2))

read_excel(here::here("data","ukdict.xlsx"), sheet=3) %>%
  kable(booktabs = TRUE)%>%
  kable_styling(fixed_thead = T) %>% 
  kable_paper("striped") %>%
  row_spec(0, bold = T, color = "#f3ac50", background = "#2596be", align = "c") %>%
  column_spec(2, italic = T)
```

#### Data Limitations

## Data Exploration
The analysis is completed using R Studio @rstudio. Packages used are `tidyverse` @R-tidyverse, `ggplot2` @R-ggplot2, `gganimate` @gganimate, `readxl` @readxl, `plotly` @R-plotly, `kableExtra` @kableExtra, `lubridate` @lubridate, and `leaflet` @leaflet.


### Vaccine helps!
```{r daily-update-of-covid}
scatter <- ukdaily %>% 
  ggplot(aes(x= date, y = newCasesBySpecimenDate, 
             colour = newDeaths28DaysByDeathDate))+
  geom_line(alpha = 0.6)+
  geom_point()+
  labs(title = "Daily COVID-19 Cases and Deaths in the United Kingdom",
       colour ="Daily Deaths",
       x = "Date",
       y ="Daily Confirmed Cases")+
  scale_colour_gradient(low = "blue", high = "black")+ theme_minimal()+
  theme(legend.position = "bottom")

scatter.animate <- scatter + 
  transition_reveal(date)+
  view_follow(fixed_y = TRUE)
animate(scatter.animate, fps = 30, duration = 10, end_pause = 60)
anim_save("scatter.gif")

```

```{r}
ukvacc_longer <- ukvacc %>% 
  rename("1st Dose"=cumVaccinationFirstDoseUptakeByPublishDatePercentage,
         "2nd Dose" = cumVaccinationSecondDoseUptakeByPublishDatePercentage) %>% 
    pivot_longer(cols=c("1st Dose","2nd Dose"),
                        names_to = "doses",
                        values_to = "percentage")

vaccpop <- ukvacc_longer %>% ggplot(aes(x = date,
                             y = percentage,
                             colours = doses))+ 
  geom_ribbon(aes(ymin = min(percentage),ymax = percentage, fill = doses))+
  labs(title = "Latest reported vaccination uptake (in 2021)",
       colour ="Doses",
       x = "Date",
       y ="Percentage of population\nvaccinated(16yr+)")+ 
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week",
             date_labels = "%B")+
  scale_y_continuous(breaks = seq(0,100, by=20),
                     labels = ~scales::percent(., scale = 1))+
  scale_fill_manual(values=c("#5F9EA0", "#E1B378"))+theme_minimal()+
  theme(legend.position = "bottom",
        axis.text.x = element_text(angle=90,vjust = 0.5))

vaccpop %>% ggplotly()%>%
  #rangeslider() %>% 
  layout(hovermode ="x unified",
         legend = list(orientation = "h"))
```

### Vaccination in England(by Regions)

```{r map}
regions <- sf::st_read(here::here("data","RegionsBoundaries.geojson"))

# Creating a color palette based on the number range in the total column
pal <- colorBin("Blues", domain=vaccdf$`Completely Vaccinated`, bin = 4, pretty = FALSE)

# Setting up the pop up text
popup_sb <- paste0("Region: ",
                   vaccdf$areaName,
                   "<br>Fully Vacc: ",
                   vaccdf$`Completely Vaccinated`,"</br>")

#setting up the labels
labels <- lapply(seq(nrow(vaccdf)), function(i) {
  paste0( "Region: ",vaccdf[i, "areaName"], 
          '<br>Region Population: ',vaccdf[i, 'pop'],
          '</br>Fully Vacc: ',vaccdf[i, 'Completely Vaccinated'],
          '<br>First Dose: ', vaccdf[i, "firstperc"],'%',
          '</br>Second Dose: ', vaccdf[i, "secondperc"],'%') 
})

leaflet(regions) %>% 
  addPolygons(opacity =1,
              fillOpacity = 1,
              smoothFactor = 0.5,
              color = "black",
              fillColor = ~pal(vaccdf$`Completely Vaccinated`),
              weight =1,
              popup = ~popup_sb,
              popupOptions = popupOptions(direction ="auto",
                                           autoPanPadding = c(1,1)),
              label = ~lapply(labels, htmltools::HTML),
              highlight = highlightOptions(
                      fillOpacity =1,
                      fillColor = "red",
                      opacity = 1.0,
                      bringToFront = TRUE,
                      sendToBack = TRUE)) %>% 
  addLegend(pal = pal,
            values = ~vaccdf$`Completely Vaccinated`,
            position = "bottomleft",
            title= "Fully Vaccinated Population")
```

